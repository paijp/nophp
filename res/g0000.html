<FORM method=POST>
Welcome `login__:loginrecord`!
<INPUT type=submit name=":logout" value="logout">
<A href="g9999.html">index</A>
</FORM>
<FORM method=POST>
<INPUT type=text name=":reportbody" size=60>
<INPUT type=submit value="send report">
</FORM>
<TABLE border width="32%">
<TR><TH>tables.php
<TR><TD><PRE>&lt;?php

class	message0_table extends a_table {
	function	getconfig() {
		return parent::getconfig().&lt;&lt;&lt;EOO

EOO;
	}
}
new message0_table();

</PRE>
</TABLE>

<UL>
	<LI>何もないテーブル「message0」を作っています。
	<LI>テーブル名のクラスは英数字_tableとし、直後にnewをおこなってください。
	<LI>コンストラクタ内で、グローバル変数に登録しています。
</UL>

<TABLE border width="96%">
<TR><TH>g0000.html
<TH>HTML sent to the browser
<TH>Display on the browser(can be operated)
<TR><TD width="33%">&lt;FORM method=POST&gt;<br />
`:bq`login__:loginrecord`:bq`さん、いらっしゃいませ。<br />
&lt;INPUT type=submit name=&quot;:logout&quot; value=&quot;ログアウト&quot;&gt;<br />
&lt;/FORM&gt;<br />
<br />

<TD width="34%"><!--{htmlsrc--><FORM method=POST>
`login__:loginrecord`さん、いらっしゃいませ。
<INPUT type=submit name=":logout" value="ログアウト">
</FORM>

<!--}-->
<TD width="33%"><FORM method=POST>
`login__:loginrecord`さん、いらっしゃいませ。
<INPUT type=submit name=":logout" value="ログアウト">
</FORM>


</TABLE>

<UL>
	<LI>こちらが、ログインすると表示されるページです。
	<LI>ファイル名は、 /^[a-z]+[0-9]+[a-z]*[.]html$/ を受け付けます。
</UL>


<UL>
	<LI>「`:bq`login__:loginrecord`:bq`」という部分は、実際にはログインユーザー名になります。
	<LI>この、バッククォートで囲まれた部分にコマンドを書くことで、コンテンツを表示します。
	<LI>FORMタグを一度閉じていますが、これは後半にあるテキストボックスでEnterを押したときに、前半のログアウトボタンが押されてしまうのを避けるためです。
</UL>


<UL>
	<LI>また、&lt;/FORM&gt;の直前に、submitkeyが自動で挿入されています。
	<LI>これは、外部からのフォームアクセスを防止するためのものです。
	<LI>ログインするたびに、submitkeyは自動でランダムに変化し、システムの最新の値と一致しないとsubmitは受け付けられません。
</UL>

<TABLE border width="96%">
<TR><TH>g0000.html (continued)
<TH>HTML sent to the browser
<TH>Display on the browser(can be operated)
<TR><TD width="33%">&lt;FORM method=POST&gt;<br />
&lt;!--{tableid message0--&gt;<br />
記事を投稿する:<br />
&lt;TEXTAREA name=&quot;body&quot; cols=40 rows=10&gt;&lt;/TEXTAREA&gt;<br />
&lt;INPUT type=submit name=&quot;:curtable:h_update:popall:curpage:jump&quot; value=&quot;投稿&quot;&gt;<br />
&lt;!--}--&gt;<br />
&lt;/FORM&gt;<br />
<br />

<TD width="34%"><!--{htmlsrc--><FORM method=POST>
<!--{tableid message0-->
記事を投稿する:
<TEXTAREA name="body" cols=40 rows=10></TEXTAREA>
<INPUT type=submit name=":curtable:h_update:popall:curpage:jump" value="投稿">
<!--}-->
</FORM>

<!--}-->
<TD width="33%"><FORM method=POST>
<!--{tableid message0-->
記事を投稿する:
<TEXTAREA name="body" cols=40 rows=10></TEXTAREA>
<INPUT type=submit name=":curtable:h_update:popall:curpage:jump" value="投稿">
<!--}-->
</FORM>


</TABLE>

<UL>
	<LI>「&lt;!--{tableid message0--&gt;」の部分は、HTMLコメントですので表示されません。
	<LI>この部分に、制御構造を書きます。
	<LI>「&lt;!--{tableid message0--&gt;」から「&lt;!--}--&gt;」の範囲は、message0テーブルに新規レコードを登録するための記述であることを示します。
	<LI>この区間にINPUTタグを置くと、nameに対応したフィールドをデータベースに書き込めます。
	<LI>なお、数字で始まるnameはデータベースに出力されません。検索用や、javascriptで他のhidden項目に出力するために、利用することができます。
</UL>

<TABLE border width="96%">
<TR><TH>g0000.html (continued)
<TH>HTML sent to the browser
<TH>Display on the browser(can be operated)
<TR><TD width="33%">&lt;!--{selectrows from message0 order by id desc --&gt;<br />
&lt;HR&gt;<br />
&lt;PRE&gt;`:bq`body__:r`:bq`&lt;/PRE&gt;<br />
&lt;!--}--&gt;<br />
<br />
&lt;HR&gt;<br />
<br />

<TD width="34%"><!--{htmlsrc--><!--{selectrows from message0 order by id desc -->
<HR>
<PRE>`body__:r`</PRE>
<!--}-->

<HR>

<!--}-->
<TD width="33%"><!--{selectrows from message0 order by id desc -->
<HR>
<PRE>`body__:r`</PRE>
<!--}-->

<HR>


</TABLE>

<UL>
	<LI>これは、上記でPOSTされたものを表示する部分です。
	<LI>「&lt;!--{selectrows」には、SQLのselect文のfromやorderやwhereやlimitやoffsetを書くことができます。
	<LI>「&lt;!--{selectrows」から「&lt;!--}--&gt;」までのあいだが、レコードの数だけ繰り返され、それぞれのレコードについて処理をおこなうことができます。
</UL>


<UL>
	<LI>さきほどの箇所で、type=submitのnameが「:curtable:h_update:popall:curpage:jump」となっています。
	<LI>これは、バッククォートの記述と共通になっています。
	<LI>nameに使えるのが英数字と「_」「:」「.」「 」だけで、「.」「 」はphpによって「_」に置き換えられてしまうため、以下のようにしています。
</UL>
<UL><UL>
	<LI>「__」で項目を区切ります。
	<LI>「:」で始まる項目はコマンド、そうでない項目は文字列です。
	<LI>ただし、コマンドどうしは「__」で区切らずに続けて書くことができます。
</UL></UL>


<UL>
	<LI>例えば、前述の「login__:loginrecord」は、以下の意味になります。
</UL>
<UL><UL>
	<LI>文字列「login」。
	<LI>コマンド「:loginrecord」。
</UL></UL>


<UL>
	<LI>上記の「:curtable:h_update:popall:curpage:jump」は、以下のようになります。
</UL>
<UL><UL>
	<LI>コマンド「:curtable」「:h_update」「:popall」「:curpage」「:jump」。
</UL></UL>


<UL>
	<LI>コマンド「:curtable」は、現在のテーブル、つまり「&lt;!--{tableid」で宣言された「message0」を返します。
	<LI>コマンド「:h_update」は、指定されたテーブルを更新します。今回は新規レコードの登録ですので、実際にはinsertされ、そのレコードIDを返します。
	<LI>このときのフィールドには、「&lt;!--{tableid」から「&lt;!--}--&gt;」の範囲にあるINPUTタグが使用されます。
	<LI>なお、「:h_update」のコマンドは、INPUT type=submitのname中に書いたものしか効果がありません。例えば、バッククォート中に書いても、データベースを更新することはできません。
	<LI>コマンド「:popall」は、返り値を捨てます。
	<LI>コマンド「:curpage」は、現在のページ名(index.php/g0000.htmlならg0000)を返します。
	<LI>コマンド「:jump」は、指定されたページにジャンプ(302によるリダイレクト)します。この場合は、直前の「g0000」つまり、自分自身にジャンプします。
	<LI>これは、method=POSTのフォームは、ブラウザでリロードをおこなうと再度POSTされてしまい不便なので、リダイレクトして履歴を上書きする目的で使用しています。
</UL>


<UL>
	<LI>ところで、前述のtables.phpでのテーブル定義では、何もフィールドを登録していませんでした。
	<LI>このフレームワークでは、テーブルを生成すると自動的に、id、mixed、created、modified、deletedのフィールドが作られます。
	<LI>そして、テーブルに登録されていないフィールドにアクセスすると、自動的にmixedというフィールドの中にエスケープして保存されます。
</UL>


<UL>
	<LI>「`:bq`body__:r`:bq`」で、現在レコードの、つまりselectrowsが現在処理しているレコードの、bodyフィールドを取得します。
</UL>


<HR>
